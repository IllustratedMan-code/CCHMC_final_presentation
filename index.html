<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Journey Through the Pipeline</title>
<meta name="author" content="David Lewis"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./revealjs/dist/reveal.css"/>

<link rel="stylesheet" href="./revealjs/dist/theme/serif.css" id="theme"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">Journey Through the Pipeline</h1>
</section>


<section>
<section id="slide-orgd4fdf6b">
<h2 id="orgd4fdf6b">Who am I?</h2>
<ul>
<li>COOP Student from UC</li>
<li>Computational Team</li>

</ul>


<div id="org09e53c8" class="figure">
<p><img src="DNA.svg" alt="DNA.svg" class="org-svg" />
</p>
</div>
</section>
<section id="slide-org6715694">
<h3 id="org6715694">What Have I been doing?</h3>
<ul>
<li>Mixtape Engineers</li>
<li><code>trackgen</code></li>
<li><code>compileqc</code></li>
<li><code>atac_seq_mixtape</code></li>

</ul>

<p class="fragment (zoom-in)">
<b>Let&rsquo;s Git started!</b>
</p>
</section>
</section>
<section>
<section id="slide-orgca36253">
<h2 id="orgca36253">Mixtape Engineers</h2>
<ul>
<li>Gitlab repo that facilitates team organization</li>
<li>Set of standards for new projects</li>
<li>Engineering rigor</li>

</ul>
</section>
<section id="slide-org83e943d">
<h3 id="org83e943d">Agile Board</h3>

<div id="org659f8cf" class="figure">
<p><img src="agile_board.png" alt="agile_board.png" />
</p>
</div>
</section>
<section id="slide-org581364d">
<h3 id="org581364d">Project Structure</h3>

<div id="org212f0b5" class="figure">
<p><img src="mixtape_engineers.png" alt="mixtape_engineers.png" width="840px" />
</p>
</div>
</section>
<section id="slide-org4187822">
<h3 id="org4187822">Rationale (why not the wiki?)</h3>
<ul>
<li>Companion to the ASAP wiki page</li>
<li>Advanced version control</li>
<li>Used as an example project</li>

</ul>

</section>
</section>
<section>
<section id="slide-orga3971bc">
<h2 id="orga3971bc">Trackgen</h2>
<ul>
<li>Generate UCSC trackhub config files
<img src="trackgen.png" alt="trackgen.png" /></li>

</ul>
</section>
<section id="slide-orga5b08c6">
<h3 id="orga5b08c6">Output</h3>

<div id="orge549f09" class="figure">
<p><img src="trackgen_output.png" alt="trackgen_output.png" />
</p>
</div>
</section>
<section id="slide-orga8a1598">
<h3 id="orga8a1598">Usage</h3>
<div class="org-src-container">

<pre class="src src-bash">trackgen --help <span style="color: #5f676b;"># </span><span style="color: #5f676b;">get some help</span>
trackgen config <span style="color: #5f676b;"># </span><span style="color: #5f676b;">generates trackgen config, finds required files</span>
trackgen hub <span style="color: #5f676b;"># </span><span style="color: #5f676b;">generates hub config</span>
</pre>
</div>

<div id="org58ea576" class="figure">
<p><img src="trackgenhelp.png" alt="trackgenhelp.png" />
</p>
</div>
</section>
<section id="slide-org7dba836">
<h3 id="org7dba836">Config</h3>
<div class="org-src-container">

<pre class="src src-json">{
    <span style="color: #a7c080;">"hub"</span>: {
        <span style="color: #a7c080;">"hg19"</span>: {
            <span style="color: #a7c080;">"first.bigwig"</span>: {
                <span style="color: #a7c080;">"bigDataUrl"</span>: <span style="color: #83c092;">"first.bigwig"</span>,
                <span style="color: #a7c080;">"type"</span>: <span style="color: #83c092;">"bigWig"</span>,
                <span style="color: #a7c080;">"color"</span>: <span style="color: #83c092;">"color(#4287f5)"</span>
            }
        }
    }
}
</pre>
</div>

</section>
<section id="slide-orgbe6f9c6">
<h3 id="orgbe6f9c6">Containers and Modules</h3>
<ul>
<li>Module is stable, container is unstable</li>

</ul>
<div class="org-src-container">

<pre class="src src-bash">module load trackgen/0.0.1-dev
trackgen --help
<span style="color: #5f676b;"># </span><span style="color: #5f676b;">is equivalent to</span>
module load singularity
singularity run $<span style="color: #9da9a0;">TEAM</span>/lew2mz/containers/trackgen --help
</pre>
</div>
</section>
<section id="slide-orgf9d1c92">
<h3 id="orgf9d1c92">Features</h3>
<ul>
<li>Functional config language (modified JSON/YAML)</li>
<li>Regex/glob based detection of files</li>
<li>JSON/YAML to hub conversion</li>

</ul>
</section>
<section id="slide-org177b3c5">
<h3 id="org177b3c5">Development strategy</h3>
<ul>
<li>Unit tests</li>
<li>Easily extendable</li>
<li>Automatic Documentation</li>

</ul>


<div id="org20565c0" class="figure">
<p><img src="trackgen_docs.png" alt="trackgen_docs.png" />
</p>
</div>
</section>
<section id="slide-org49e4bce">
<h3 id="org49e4bce">Project structure</h3>
<pre class="example">
trackgen
├── classes.py
├── CLI.py
├── config.py
├── data
│   ├── associations.json
│   ├── common.json
│   ├── complete.json
│   ├── defaults.json
│   ├── example_config.json
│   ├── example_hub.txt
│   ├── __init__.py
│   ├── __pycache__
│   ├── README.org
│   ├── template_page.html
│   └── valid_file_extensions.json
├── data_interpreter.py
├── functions.py
├── __init__.py
├── __main__.py
└── __pycache__
</pre>
</section>
<section id="slide-org58ffc6f">
<h3 id="org58ffc6f">Architecture</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><img src="trackgen_high_level.png" alt="trackgen_high_level.png" /></td>
<td class="org-left"><img src="trackgen_low_level.png" alt="trackgen_low_level.png" /></td>
</tr>
</tbody>
</table>

</section>
</section>
<section>
<section id="slide-orga55db69">
<h2 id="orga55db69">Compileqc</h2>
<ul>
<li>Generate QC sheet from pipeline</li>
<li>Budget Multiqc</li>

</ul>
</section>
<section id="slide-orgca52bab">
<h3 id="orgca52bab">Usage</h3>
<div class="org-src-container">

<pre class="src src-bash">module load singularity
singularity run $<span style="color: #9da9a0;">TEAM</span>/lew2mz/containers/compileqc --help
</pre>
</div>

<div id="org687dfbb" class="figure">
<p><img src="compileqchelp.png" alt="compileqchelp.png" />
</p>
</div>
</section>
<section id="slide-org542226c">
<h3 id="org542226c">Output</h3>
<ul>
<li>Configurable shortname</li>
<li>Different Sheets for each data type</li>

</ul>

<div id="orga887c0b" class="figure">
<p><img src="spreadsheet.png" alt="spreadsheet.png" />
</p>
</div>
</section>
<section id="slide-orge70cf63">
<h3 id="orge70cf63">Features</h3>
<p>
Aggregate the following output:
</p>
<ul>
<li>Homer</li>
<li>(TF/NONTF) RELI</li>
<li>ENCODE</li>

</ul>
</section>
<section id="slide-org1ae758f">
<h3 id="org1ae758f">Development strategy</h3>
<ul>
<li>Test based development</li>
<li>Object oriented</li>
<li>Design before code</li>
<li>Automatic documentation</li>
<li>Extendable</li>

</ul>
</section>
<section id="slide-orgf9946c8">
<h3 id="orgf9946c8">Project Structure</h3>
<pre class="example">
compileqc
├── cli.py
├── data.py
├── __init__.py
├── __main__.py
└── __pycache__
</pre>
</section>
<section id="slide-org88490eb">
<h3 id="org88490eb">Architecture</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><img src="compileqc_high_level.png" alt="compileqc_high_level.png" /></td>
<td class="org-left"><img src="compileqc_low_level.png" alt="compileqc_low_level.png" /></td>
</tr>
</tbody>
</table>
</section>
</section>
<section>
<section id="slide-org18a2b98">
<h2 id="org18a2b98">Atac seq mixtape</h2>
<ul>
<li>Nextflow pipeline to automate analysis</li>

</ul>
</section>
<section id="slide-org09be6a9">
<h3 id="org09be6a9">Contribution</h3>
<ul>
<li>Make UI</li>
<li>compilqc integration</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgede61c9">
<h2 id="orgede61c9">Compileqc integration</h2>
<ul>
<li>New and improved QC sheet</li>

</ul>
</section>
<section id="slide-orgc12dd92">
<h3 id="orgc12dd92">Implementation details</h3>
<ul>
<li>Added an easy way to add new flags</li>
<li>New mapping json input allows for shortname configuration in QC sheet</li>
<li>No module dependencies, uses singularity containers</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgaf54ad4">
<h2 id="orgaf54ad4">Make UI</h2>
<ul>
<li>Intuitive interface</li>
<li>Automatic help generation</li>
<li><p>
Error detection
</p>


<div id="org86cf318" class="figure">
<p><img src="make_interface.gif" alt="make_interface.gif" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org944e5dd">
<h3 id="org944e5dd">Usage</h3>
<div class="leftcol" id="orged91245">
<div class="org-src-container">

<pre class="src src-bash"><span style="color: #fdf6e3;">make</span> <span style="color: #5f676b;"># </span><span style="color: #5f676b;">or </span><span style="color: #5f676b;">make</span><span style="color: #5f676b;"> help</span>
<span style="color: #fdf6e3;">make</span> config <span style="color: #5f676b;"># </span><span style="color: #5f676b;">will guide you through initial data entry</span>
<span style="color: #fdf6e3;">make</span> config <span style="color: #5f676b;"># </span><span style="color: #5f676b;">run it after data entry</span>
<span style="color: #fdf6e3;">make</span> run <span style="color: #5f676b;"># </span><span style="color: #5f676b;">run the pipeline (will fail)</span>
</pre>
</div>

</div>
<div class="rightcol" id="org4f5c053">

<div id="org3bb191a" class="figure">
<p><img src="make_help.png" alt="make_help.png" width="70%" />
</p>
</div>

</div>
</section>
<section id="slide-org4a4037d">
<h3 id="org4a4037d">Help code</h3>
<div class="org-src-container">

<pre class="src src-makefile"><span style="color: #a7c080;">help</span>: <span style="color: #5f676b;">## </span><span style="color: #5f676b;">show this help</span>
    <span style="color: #fdf6e3;">@</span>sed -ne <span style="color: #83c092;">"s/^##\(.*\)/\1/p"</span> $(<span style="color: #9da9a0;">MAKEFILE_LIST</span>)
    <span style="color: #fdf6e3;">@</span>printf <span style="color: #83c092;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">blue</span><span style="color: #83c092;">) Make Commands $(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span>
    <span style="color: #fdf6e3;">@</span>sed -ne <span style="color: #83c092;">"/@sed/!s/\(^[^#?=]*:\).*##\(.*\)/$(</span><span style="color: #9da9a0;">green</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)\1$(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)\2/p"</span> $(<span style="color: #9da9a0;">MAKEFILE_LIST</span>)
    <span style="color: #fdf6e3;">@</span>printf <span style="color: #83c092;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">blue</span><span style="color: #83c092;">) Make Variables $(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span>
    <span style="color: #fdf6e3;">@</span>sed -ne <span style="color: #83c092;">"/@sed/!s/\([^ ]*\) *?=\(.*\)##\(.*\)/$(</span><span style="color: #9da9a0;">blue</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)\1:$(</span><span style="color: #9da9a0;">magenta</span><span style="color: #83c092;">)\2$(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)\3/p"</span> $(<span style="color: #9da9a0;">MAKEFILE_LIST</span>)
    <span style="color: #fdf6e3;">@</span>printf <span style="color: #83c092;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">yellow</span><span style="color: #83c092;">) Nextflow Arguments $(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span>
    <span style="color: #fdf6e3;">@</span>sed -ne <span style="color: #83c092;">"/@sed/!s/params.\([a-zA-Z]*\) *= *\(.*\)\/\/\(.*\)/$(</span><span style="color: #9da9a0;">yellow</span><span style="color: #83c092;">)$(</span><span style="color: #9da9a0;">bold</span><span style="color: #83c092;">)--\1:$(</span><span style="color: #9da9a0;">magenta</span><span style="color: #83c092;">) \2$(</span><span style="color: #9da9a0;">reset</span><span style="color: #83c092;">)\3/p"</span> nextflow.config
    <span style="color: #fdf6e3;">@</span>printf <span style="color: #83c092;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span>
</pre>
</div>
</section>
<section id="slide-orgb3f57ac">
<h3 id="orgb3f57ac">Advantages over the old method</h3>
<ul>
<li>Users don&rsquo;t have to learn a new configuration framework</li>
<li>Options have sane defaults</li>
<li>More intuitive</li>
<li>Automatic documentation</li>

</ul>
</section>
<section id="slide-org562cd9b">
<h3 id="org562cd9b">Wiki</h3>
<p>
<a href="https://tfwiki.cchmc.org/wiki/ENCODE/pipeline/automation">ATAC-seq Mixtape</a>
</p>
</section>
</section>
<section>
<section id="slide-org9d6958f">
<h2 id="org9d6958f">That&rsquo;s it!</h2>
</section>
</section>
</div>
</div>
<script src="./revealjs/dist/reveal.js"></script>
<script src="./revealjs/plugin/markdown/markdown.js"></script>
<script src="./revealjs/plugin/notes/notes.js"></script>
<script src="./revealjs/plugin/search/search.js"></script>
<script src="./revealjs/plugin/zoom/zoom.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,

transition: 'convex',
transitionSpeed: 'default',

// Plugins with reveal.js 4.x
plugins: [ RevealMarkdown, RevealNotes, RevealSearch, RevealZoom ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
